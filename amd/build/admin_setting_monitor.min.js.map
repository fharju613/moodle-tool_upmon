{"version":3,"file":"admin_setting_monitor.min.js","sources":["../src/admin_setting_monitor.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for monitor configuration admin setting.\n *\n * @module     tool_upmon/admin_setting_monitor\n * @copyright  2025 Frederick Harju <fharju@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Initialize the monitor configuration UI.\n *\n * @param {string} selectId - The ID of the monitor select dropdown\n * @param {Array} monitors - Array of monitor objects from UptimeRobot\n * @param {string} defaultName - Default site name for new monitors\n * @param {string} typeChangeInfo - Warning message for type change attempts\n */\nexport const init = (selectId, monitors, defaultName, typeChangeInfo) => {\n    /**\n     * Update form fields based on selected monitor.\n     *\n     * @param {boolean} setDefaultRadio - Whether to set default radio selection\n     */\n    const updateFields = (setDefaultRadio = true) => {\n        const select = document.getElementById(selectId);\n        const friendlyInput = document.getElementById(selectId + '_friendlyname');\n        const typeKeyword = document.getElementById(selectId + '_type_keyword');\n        const typeHeartbeat = document.getElementById(selectId + '_type_heartbeat');\n        const tokenInput = document.getElementById('id_s_tool_upmon_check_token');\n\n        if (!select || !friendlyInput || !typeKeyword || !typeHeartbeat) {\n            return;\n        }\n\n        const val = select.value;\n        let isHeartbeat = false;\n\n        if (val === '') {\n            // Nothing selected - disable fields.\n            friendlyInput.disabled = true;\n            friendlyInput.value = '';\n            typeKeyword.disabled = true;\n            typeHeartbeat.disabled = true;\n\n            if (tokenInput) {\n                if (!tokenInput.hasAttribute('data-original-value')) {\n                    tokenInput.setAttribute('data-original-value', tokenInput.value);\n                }\n                tokenInput.disabled = true;\n                tokenInput.value = '';\n            }\n        } else if (val === 'new') {\n            // Create new - enable fields.\n            friendlyInput.disabled = false;\n            if (setDefaultRadio) {\n                friendlyInput.value = defaultName;\n            }\n            typeKeyword.disabled = false;\n            typeHeartbeat.disabled = false;\n            if (setDefaultRadio) {\n                typeKeyword.checked = true;\n            }\n\n            if (tokenInput) {\n                tokenInput.disabled = false;\n                if (tokenInput.hasAttribute('data-original-value')) {\n                    tokenInput.value = tokenInput.getAttribute('data-original-value');\n                }\n            }\n        } else {\n            // Existing monitor - populate from data.\n            friendlyInput.disabled = false;\n            typeKeyword.disabled = false;\n            typeHeartbeat.disabled = false;\n\n            for (let i = 0; i < monitors.length; i++) {\n                if (monitors[i].id == val) {\n                    friendlyInput.value = monitors[i].friendlyName || monitors[i].friendly_name || '';\n                    if (monitors[i].type === 'HEARTBEAT') {\n                        typeHeartbeat.checked = true;\n                        isHeartbeat = true;\n                    } else {\n                        typeKeyword.checked = true;\n                    }\n                    break;\n                }\n            }\n        }\n\n        // Handle token disable/blanking for Heartbeat.\n        if (typeHeartbeat.checked) {\n            isHeartbeat = true;\n        }\n\n        if (tokenInput) {\n            if (isHeartbeat) {\n                if (!tokenInput.hasAttribute('data-original-value')) {\n                    tokenInput.setAttribute('data-original-value', tokenInput.value);\n                }\n                tokenInput.disabled = true;\n                tokenInput.value = '';\n            } else if (val !== '') {\n                tokenInput.disabled = false;\n                if (tokenInput.hasAttribute('data-original-value')) {\n                    tokenInput.value = tokenInput.getAttribute('data-original-value');\n                }\n            }\n        }\n    };\n\n    /**\n     * Handle monitor type radio button change.\n     *\n     * @param {Event} event - The change event\n     */\n    const handleTypeChange = (event) => {\n        const select = document.getElementById(selectId);\n        const typeKeyword = document.getElementById(selectId + '_type_keyword');\n        const typeHeartbeat = document.getElementById(selectId + '_type_heartbeat');\n        const tokenInput = document.getElementById('id_s_tool_upmon_check_token');\n\n        if (select.value && select.value !== 'new') {\n            // Existing monitor - type cannot be changed.\n            const selectedMonitorId = select.value;\n            let originalMonitorType = '';\n\n            for (let i = 0; i < monitors.length; i++) {\n                if (monitors[i].id == selectedMonitorId) {\n                    originalMonitorType = monitors[i].type;\n                    break;\n                }\n            }\n\n            const newType = typeKeyword.checked ? 'KEYWORD' : 'HEARTBEAT';\n\n            if (originalMonitorType && newType !== originalMonitorType) {\n                // Show warning and revert.\n                window.alert(typeChangeInfo);\n\n                if (originalMonitorType === 'HEARTBEAT') {\n                    typeHeartbeat.checked = true;\n                } else {\n                    typeKeyword.checked = true;\n                }\n\n                event.preventDefault();\n                return false;\n            }\n        } else if (select.value === 'new') {\n            // New monitor - user is allowed to change type.\n            const isHeartbeat = typeHeartbeat.checked;\n\n            if (tokenInput) {\n                if (isHeartbeat) {\n                    if (!tokenInput.hasAttribute('data-original-value')) {\n                        tokenInput.setAttribute('data-original-value', tokenInput.value);\n                    }\n                    tokenInput.disabled = true;\n                    tokenInput.value = '';\n                } else {\n                    tokenInput.disabled = false;\n                    if (tokenInput.hasAttribute('data-original-value')) {\n                        tokenInput.value = tokenInput.getAttribute('data-original-value');\n                    }\n                }\n            }\n            return;\n        }\n    };\n\n    // Get DOM elements.\n    const select = document.getElementById(selectId);\n    const typeKeyword = document.getElementById(selectId + '_type_keyword');\n    const typeHeartbeat = document.getElementById(selectId + '_type_heartbeat');\n\n    if (!select) {\n        return;\n    }\n\n    // Attach event listeners.\n    select.addEventListener('change', () => updateFields(true));\n\n    if (typeKeyword) {\n        typeKeyword.addEventListener('change', handleTypeChange);\n    }\n    if (typeHeartbeat) {\n        typeHeartbeat.addEventListener('change', handleTypeChange);\n    }\n\n    // Initialize fields on load.\n    updateFields(true);\n};\n"],"names":["selectId","monitors","defaultName","typeChangeInfo","updateFields","setDefaultRadio","select","document","getElementById","friendlyInput","typeKeyword","typeHeartbeat","tokenInput","val","value","isHeartbeat","disabled","hasAttribute","setAttribute","checked","getAttribute","i","length","id","friendlyName","friendly_name","type","handleTypeChange","event","selectedMonitorId","originalMonitorType","newType","window","alert","preventDefault","addEventListener"],"mappings":"qKA+BoB,CAACA,SAAUC,SAAUC,YAAaC,wBAM5CC,aAAe,eAACC,iFACZC,OAASC,SAASC,eAAeR,UACjCS,cAAgBF,SAASC,eAAeR,SAAW,iBACnDU,YAAcH,SAASC,eAAeR,SAAW,iBACjDW,cAAgBJ,SAASC,eAAeR,SAAW,mBACnDY,WAAaL,SAASC,eAAe,oCAEtCF,QAAWG,eAAkBC,aAAgBC,4BAI5CE,IAAMP,OAAOQ,UACfC,aAAc,KAEN,KAARF,IAEAJ,cAAcO,UAAW,EACzBP,cAAcK,MAAQ,GACtBJ,YAAYM,UAAW,EACvBL,cAAcK,UAAW,EAErBJ,aACKA,WAAWK,aAAa,wBACzBL,WAAWM,aAAa,sBAAuBN,WAAWE,OAE9DF,WAAWI,UAAW,EACtBJ,WAAWE,MAAQ,SAEpB,GAAY,QAARD,IAEPJ,cAAcO,UAAW,EACrBX,kBACAI,cAAcK,MAAQZ,aAE1BQ,YAAYM,UAAW,EACvBL,cAAcK,UAAW,EACrBX,kBACAK,YAAYS,SAAU,GAGtBP,aACAA,WAAWI,UAAW,EAClBJ,WAAWK,aAAa,yBACxBL,WAAWE,MAAQF,WAAWQ,aAAa,6BAGhD,CAEHX,cAAcO,UAAW,EACzBN,YAAYM,UAAW,EACvBL,cAAcK,UAAW,MAEpB,IAAIK,EAAI,EAAGA,EAAIpB,SAASqB,OAAQD,OAC7BpB,SAASoB,GAAGE,IAAMV,IAAK,CACvBJ,cAAcK,MAAQb,SAASoB,GAAGG,cAAgBvB,SAASoB,GAAGI,eAAiB,GACtD,cAArBxB,SAASoB,GAAGK,MACZf,cAAcQ,SAAU,EACxBJ,aAAc,GAEdL,YAAYS,SAAU,SAQlCR,cAAcQ,UACdJ,aAAc,GAGdH,aACIG,aACKH,WAAWK,aAAa,wBACzBL,WAAWM,aAAa,sBAAuBN,WAAWE,OAE9DF,WAAWI,UAAW,EACtBJ,WAAWE,MAAQ,IACJ,KAARD,MACPD,WAAWI,UAAW,EAClBJ,WAAWK,aAAa,yBACxBL,WAAWE,MAAQF,WAAWQ,aAAa,2BAWrDO,iBAAoBC,cAChBtB,OAASC,SAASC,eAAeR,UACjCU,YAAcH,SAASC,eAAeR,SAAW,iBACjDW,cAAgBJ,SAASC,eAAeR,SAAW,mBACnDY,WAAaL,SAASC,eAAe,kCAEvCF,OAAOQ,OAA0B,QAAjBR,OAAOQ,MAAiB,OAElCe,kBAAoBvB,OAAOQ,UAC7BgB,oBAAsB,OAErB,IAAIT,EAAI,EAAGA,EAAIpB,SAASqB,OAAQD,OAC7BpB,SAASoB,GAAGE,IAAMM,kBAAmB,CACrCC,oBAAsB7B,SAASoB,GAAGK,iBAKpCK,QAAUrB,YAAYS,QAAU,UAAY,eAE9CW,qBAAuBC,UAAYD,2BAEnCE,OAAOC,MAAM9B,gBAEe,cAAxB2B,oBACAnB,cAAcQ,SAAU,EAExBT,YAAYS,SAAU,EAG1BS,MAAMM,kBACC,OAER,GAAqB,QAAjB5B,OAAOQ,MAAiB,OAEzBC,YAAcJ,cAAcQ,oBAE9BP,aACIG,aACKH,WAAWK,aAAa,wBACzBL,WAAWM,aAAa,sBAAuBN,WAAWE,OAE9DF,WAAWI,UAAW,EACtBJ,WAAWE,MAAQ,KAEnBF,WAAWI,UAAW,EAClBJ,WAAWK,aAAa,yBACxBL,WAAWE,MAAQF,WAAWQ,aAAa,6BASzDd,OAASC,SAASC,eAAeR,UACjCU,YAAcH,SAASC,eAAeR,SAAW,iBACjDW,cAAgBJ,SAASC,eAAeR,SAAW,mBAEpDM,SAKLA,OAAO6B,iBAAiB,UAAU,IAAM/B,cAAa,KAEjDM,aACAA,YAAYyB,iBAAiB,SAAUR,kBAEvChB,eACAA,cAAcwB,iBAAiB,SAAUR,kBAI7CvB,cAAa"}